<fury-page-layout mode="card">
    <fury-page-layout-header>
      <fury-breadcrumbs [@fadeInRight] [crumbs]="['Prospection Reports']" current="Liste des Rapports de Prospection"></fury-breadcrumbs>
    </fury-page-layout-header>
  
    <fury-page-layout-content [@fadeInUp]>
      <fury-list *ngIf="rapports.length !== 0 && showProgressBar === true" name="Prospection Reports" [columns]="columns" (filterChange)="onFilterChange($event)">
        <div class="actions">
          <button class="create" (click)="createRapportProspection()" type="button" mat-mini-fab color="primary">
            <mat-icon>add</mat-icon>
          </button>
        </div>
        <table [dataSource]="dataSource" mat-table matSort>
          <!-- Checkbox Column -->
          <ng-container matColumnDef="checkbox">
            <th *matHeaderCellDef class="actions-cell" mat-header-cell>
              <mat-checkbox color="primary" (click)="$event.stopPropagation()"></mat-checkbox>
            </th>
            <td *matCellDef="let row" class="actions-cell" mat-cell>
              <mat-checkbox color="primary" (click)="$event.stopPropagation()"></mat-checkbox>
            </td>
          </ng-container>
  
          <ng-container *ngFor="let column of columns">
            <ng-container *ngIf="column.isModelProperty" [matColumnDef]="column.property">
              <th *matHeaderCellDef mat-header-cell mat-sort-header> {{ column.name }} </th>
              <td *matCellDef="let row" mat-cell>
                <p *ngIf="column.property === 'dateCreation'">
                  {{ row[column.property] | date: 'dd-MM-yyyy' }}
                </p>
                <p *ngIf="column.name === 'Ajoute par'">
                  {{ (row.matricule + ' | ' + row.prenom + ' ' + row.nom) | titlecase }}
                </p>
                <p *ngIf="column.name === 'Etat'">
                    <span *ngIf="row?.etat === 'A VALIDER' " class="badge badge-primary">{{ 'A Valider'}}
                    </span>
                    <span *ngIf="row?.etat === 'VALIDER' " class="badge badge-success">{{ 'Validée' }}
                    </span>
                    <span *ngIf="row?.etat === 'REJETER'" class="badge badge-danger">{{ 'rejetée' }}
                    </span>
                </p>
                <p *ngIf="column.property == 'rapport' && row[column.property]" > {{ row[column.property].name }}</p>
                <p *ngIf="column.name !== 'dateCreation' && column.name !== 'Ajoute par'  && column.name !== 'Etat' && column.property !== 'rapport'">
                  {{ row[column.property] }}
                </p>
              </td>
            </ng-container>
          </ng-container>
  
          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th *matHeaderCellDef class="actions-cell" mat-header-cell mat-sort-header></th>
            <td *matCellDef="let row" class="actions-cell" mat-cell>
              <button type="button" mat-icon-button [matMenuTriggerFor]="actionsMenu" (click)="$event.stopPropagation()">
                <mat-icon>more_horiz</mat-icon>
              </button>
              <mat-menu #actionsMenu="matMenu" yPosition="below" xPosition="before">
                <button (click)="updateDossierColonie(row)" mat-menu-item matTooltip="Modifier le Rapport">
                  <mat-icon>edit</mat-icon>
                  <span>Modifier</span>
                </button>
                <button (click)="deleteDossierColonie(row)" mat-menu-item matTooltip="Supprimer le Rapport">
                  <mat-icon>delete</mat-icon>
                  <span>Supprimer</span>
                </button>
                <button (click)="detailsDossierColonie(row)" mat-menu-item matTooltip="Détails du Rapport">
                  <mat-icon>info</mat-icon>
                  <span>Détails</span>
                </button>
                <button *ngIf="row.etat === 'A VALIDER'" (click)="validerRapportProspection(row)" mat-menu-item>
                    <mat-icon>check_circle_outline</mat-icon>
                    <span>Valider</span>
                </button>
                <button *ngIf="row.etat === 'A VALIDER'" (click)="rejeterRapportProspection(row)" mat-menu-item>
                  <mat-icon>check_circle_outline</mat-icon>
                  <span>rejeter</span>
              </button>
                <button (click)="afficherRapportProspection(row)" mat-menu-item>
                    <mat-icon>visibility</mat-icon>
                    <span>Afficher Rapport</span>
                  </button>                  
              </mat-menu>
            </td>
          </ng-container>
  
          <tr *matHeaderRowDef="visibleColumns" mat-header-row></tr>
          <tr (click)="detailsDossierColonie(row)" *matRowDef="let row; columns: visibleColumns;" class="clickable route-animations-elements" mat-row></tr>
        </table>
  
        <mat-paginator class="paginator" [pageSize]="pageSize"></mat-paginator>
      </fury-list>
      <div *ngIf="afficherRapport">
        <fury-read-rapport-prospection [rapport]="rapportSelectionne"></fury-read-rapport-prospection>
    </div>
      <div *ngIf="rapports.length === 0 && showProgressBar === true" class="card text-center">
        <div class="card-header">
          <span class="badge badge-info">INFORMATION</span>
        </div>
        <div class="card-body">
          <h5 class="card-title">PAS DE RAPPORTS DISPONIBLES</h5>
          <button mat-mini-fab color="primary" (click)="createRapportProspection()">
            <mat-icon>add</mat-icon>
          </button>
        </div>
        <div class="card-footer text-muted">
          {{ date | date : 'dd/MMM/yyyy HH:mm:ss' }}
        </div>
      </div>
  
      <mat-progress-bar *ngIf="showProgressBar === false" mode="query" color="primary"></mat-progress-bar>
    </fury-page-layout-content>
  </fury-page-layout>
  